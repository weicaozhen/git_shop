<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">   
    <title>芮享注册</title>
    <link href="/public/static/css/reset.css" rel="stylesheet" />
    <link href="/public/static/css/reg3.css" rel="stylesheet" />
    <link rel='stylesheet' type='text/css' href='/public/static/css/common2.css'>    
    <link rel="stylesheet" type="text/css" href="/public/static/css/common.min.css">
    <script type="text/javascript" src="/public/static/js/jquery-1.11.0.min.js"></script>
    <script src="/public/js/validate2.js"></script>
	<script src="/public/js/layer/layer.js"></script><!--弹窗js 参考文档 http://layer.layui.com/-->    
<meta name="__hash__" content="28e5de0aaf8b52e9d841ca55d4ae5ec1_008f1e223336fb6efc8566439c9ff31e" /></head>
<body>
    <div class="regcon">
        <a class="m-fnlogoa fn-fl" href=""><img src="/Public/images/newLogo.png"/></a><span class="m-fntit">欢迎注册</span>
        <div class="ui_tab">
            <ul class="ui_tab_nav regnav">
                <li class="uli active "><a href="{:url('home/user/reg')}" >用户注册</a></li>
                <li class="no fn-fr loginbtn">我已注册，马上<a href="{:url('home/user/login')}">登录></a></li>
            </ul>
            
<form id="reg_form2" onsubmit=" return check_submit(this)" method="post" action="">            
            <div class="ui_tab_content">
                <div class="m-fnbox ui_panel" style="display: block;">
                    <div class="fnlogin clearfix">

                    <div class="line">
                            <label class="linel"><span class="dt">用户名：</span></label>
                            <div class="liner">
                                <input type="text" class="inp fmobile J_username" placeholder="请输入用户名"  name="username" id="username" required=""/>
                                <p class="fn-fl errorbox v-txt" id="err_username_null">用户名不能为空</p>
                                <p class="fn-fl errorbox v-txt" id="err_username_cz" >用户名不能为空</p>
                            </div>
                        </div>   

                        <div class="line">
                            <label class="linel"><span class="dt">手机号码：</span></label>
                            <div class="liner">
                                <input type="text" class="inp fmobile J_cellphone" placeholder="请输入手机号码"  name="tel" id="tel" required=""/>
                                <p class="fn-fl errorbox v-txt" id="err_cellphone">手机号码输入不正确</p>
                            </div>
                        </div>      

                        <div class="line">
                            <label class="linel"><span class="dt">邮箱：</span></label>
                            <div class="liner">
                                <input type="text" class="inp fmobile J_email" placeholder="请输入邮箱"  name="email" id="email" required=""/>
                                <p class="fn-fl errorbox v-txt" id="err_email">邮箱输入不正确</p>
                            </div>
                        </div> 

                        <div class="line">
                            <label class="linel"><span class="dt">设置密码：</span></label>
                            <div class="liner">
                                <input type="password" class="inp fpass J_password" placeholder="6-16位大小写英文字母、数字或符号的组合" autocomplete="off" maxlength="16"  id="password" name="password" value="" required=""/>
                                <p class="fn-fl noticebox v-txt2" id="err_password">6-16位字符，建议由字母、数字和符号两种以上组合</p>                               
                            </div>
                        </div>
                        <div class="line">
                            <label class="linel"><span class="dt">确认密码：</span></label>
                            <div class="liner">
                                <input type="password" class="inp fsecpass J_password2" placeholder="请再次输入密码" autocomplete="off" maxlength="16" id="password2" name="password2" required="" value=""/>
                                <p class="fn-fl errorbox v-txt" id="err_password2">两次输入密码不一致</p>
                            </div>
                        </div>
						
                        <div class="line liney clearfix">
                            <label class="linel">&nbsp;</label>
                            <div class="liner">
                                <a class="regbtn J_btn_agree" id="regbtn" href="javascript:void(0);" onClick="$('#reg_form2').submit();">注&nbsp;&nbsp;&nbsp;&nbsp;册</a>
                        </div>
                    </div>
                    </div>
                    </div>
            </div>
            <input type="hidden" name="__hash__" value="28e5de0aaf8b52e9d841ca55d4ae5ec1_008f1e223336fb6efc8566439c9ff31e" />
        </form>            
        </div>
    </div>    
</div>    

<script type="text/javascript" src="/public/static/js/jquery.lazyload.js"></script>
<script type="text/javascript" src="/public/static/js/common.js"></script>
<script>

    $(document).ready(function(){
		 $('input').click(function(){
		      $(this).siblings('p').hide();
		 });
	  	
	});
 
	
    function check_submit(){
        var username = $('input[name="username"]').val();
        var tel = $('input[name="tel"]').val();
        var email = $('input[name="email"]').val();
        var password = $('#password').val();
        var password2 = $('input[name="password2"]').val();
        var error = '';
		
		$("p[id^='err_']").each(function(){
			$(this).hide();
		});			
		
       (username == '') && $('#err_username_null').show();
       (tel == '') && $('#err_cellphone').show();
	   (email == '') && $('#err_email').show();
	   (password == '') && $('#err_password').show();
	   (password2 != password) && $('#err_password2').show();

     
       //验证手机号是否正确
		if(!checkMobile(tel)){
			$('#err_cellphone').show();
		  }
        
		//验证邮箱是否正确
        if(!checkEmail(email)){
        	$('#err_email').show();
        }
        
        if($("p[id^='err_']:visible").length > 0 ) {
          return false;
        
        }
    }
    
    function checkMobile(tel) {
        var reg = /(^1[3|4|5|7|8][0-9]{9}$)/;
        if (reg.test(tel)) {
            return true;
        }else{
            return false;
        };
    }
    
    function checkEmail(str){
        var reg = /^([a-zA-Z0-9]+[_|\-|\.]?)*[a-zA-Z0-9]+@([a-zA-Z0-9]+[_|\-|\.]?)*[a-zA-Z0-9]+\.[a-zA-Z]{2,3}$/;
        if(reg.test(str)){
            return true;
        }else{
            return false;
        }
    }

$(function(){
    $('#regbtn').click(function(){
        $.ajax({
            type:"POST",
            url:"{:url('/home/user/reg')}",
            dataType:"json",
            data:{username:username,tel:tel,email:email,password:password,password2:password2},
            success:function (msg)
            {
alert(msg.txt+msg.status);
                //数据返回成功则判断用户名是否存在数据库中
                if(msg.status == '1'){
                    $('#err_username').show();
                }
            }
                
                 });
        }) ; 
     });  
</script>
</body> 
</html>